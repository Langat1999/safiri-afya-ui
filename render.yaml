# Render.com Configuration
# This file allows infrastructure-as-code deployment to Render

services:
  # PostgreSQL Database
  - type: pserv
    name: safiri-afya-db
    env: docker
    plan: starter # Change to 'free' for testing or 'standard' for production
    region: frankfurt # Choose: oregon, frankfurt, singapore, ohio
    databaseName: safiri_afya
    databaseUser: safiri_afya_user
    ipAllowList: [] # Empty means accessible from anywhere

  # Backend API Web Service
  - type: web
    name: safiri-afya-api
    env: node
    region: frankfurt # Same as database for best performance
    plan: starter # Change to 'free' for testing or 'standard' for production
    rootDir: backend
    buildCommand: npm install && npm run build
    startCommand: npm run deploy
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: DATABASE_URL
        fromDatabase:
          name: safiri-afya-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true # Render will auto-generate a secure secret
      - key: MPESA_CONSUMER_KEY
        sync: false # Set manually in Render dashboard
      - key: MPESA_CONSUMER_SECRET
        sync: false
      - key: MPESA_SHORTCODE
        sync: false
      - key: MPESA_PASSKEY
        sync: false
      - key: MPESA_CALLBACK_URL
        value: https://safiri-afya-api.onrender.com/api/payments/mpesa/callback
      - key: SENDGRID_API_KEY
        sync: false # Set manually in Render dashboard
      - key: FROM_EMAIL
        value: noreply@safiriafya.com
      - key: OPENROUTER_API_KEY
        sync: false # Optional - set manually if using AI features
    autoDeploy: true # Auto-deploy on git push
    branch: main

# Note: To use this file:
# 1. Commit render.yaml to your repository
# 2. Go to Render Dashboard > "New" > "Blueprint"
# 3. Connect your repository
# 4. Render will read this file and create all resources
# 5. Manually set the 'sync: false' environment variables in the dashboard
